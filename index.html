<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MAFIA: ASSIGNMENT ROLEz</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body
    class="bg-[#050505] text-white font-mono flex justify-center items-center h-screen m-0 overflow-hidden relative"
  >
    <div
      class="pointer-events-none absolute inset-0 z-10 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,3px_100%]"
    ></div>

    <div
      class="relative bg-[#050505] border-4 border-white p-5 w-[90%] max-w-[500px] shadow-[0_0_20px_rgba(255,255,255,0.1)] uppercase"
    >
      <div
        class="text-[1.8rem] sm:text-[2rem] md:text-[2.5rem] font-black text-center border-b-[8px] border-white mb-[30px] pb-[10px] tracking-[-2px] font-['Impact']"
      >
        Once upon a village . . .
      </div>

      <div
        class="flex justify-between items-center mb-[15px] border-b border-[#444] pb-[10px]"
      >
        <span>Mafias</span>
        <input
          id="mafiasInput"
          type="number"
          min="1"
          class="bg-transparent border-none text-white font-mono text-[1.2rem] w-[50px] text-center outline-none focus:text-red-600"
        />
      </div>

      <div
        class="flex justify-between items-center mb-[15px] border-b border-[#444] pb-[10px]"
      >
        <span>Doctor</span>
        <button
          id="doctorBtn"
          onclick="toggleRole(this)"
          class="w-[50px] py-1 bg-white text-[#050505] font-bold transition duration-200"
        >
          YES
        </button>
      </div>

      <div
        class="flex justify-between items-center mb-[15px] border-b border-[#444] pb-[10px]"
      >
        <span>Detective</span>
        <button
          id="detectiveBtn"
          onclick="toggleRole(this)"
          class="w-[50px] py-1 bg-white text-[#050505] font-bold transition duration-200"
        >
          YES
        </button>
      </div>

      <div
        class="flex justify-between items-center mb-[15px] border-b border-[#444] pb-[10px]"
      >
        <span>Mayor</span>
        <button
          id="mayorBtn"
          onclick="toggleRole(this)"
          class="w-[50px] py-1 bg-red-500 text-white font-bold transition duration-200"
        >
          NO
        </button>
      </div>

      <button
        onclick="startAssignment()"
        class="mt-[30px] w-full py-5 bg-white text-[#050505] font-['Impact'] text-[1.5rem] cursor-pointer [clip-path:polygon(5%_0,100%_0,100%_70%,95%_100%,0_100%,0_30%)]"
      >
        GO TO THE GATHERING
      </button>

      <div
        class="absolute bottom-[-40px] right-[-20px] border-[3px] border-red-600 text-red-600 px-[10px] py-[5px] font-bold rotate-[-15deg] opacity-60 pointer-events-none"
      >
        TOP SECRET
      </div>
    </div>

    <script>
      const mafiasInput = document.getElementById("mafiasInput");
      const doctorBtn = document.getElementById("doctorBtn");
      const detectiveBtn = document.getElementById("detectiveBtn");
      const mayorBtn = document.getElementById("mayorBtn");

      window.onload = function () {
        const storedMafias = localStorage.getItem("mafias");
        const storedDoctor = localStorage.getItem("doctor");
        const storedDetective = localStorage.getItem("detective");
        const storedMayor = localStorage.getItem("mayor");

        // Set defaults if nothing stored
        mafiasInput.value = storedMafias ? storedMafias : 1;
        setRoleState(doctorBtn, storedDoctor ? storedDoctor : "YES");
        setRoleState(detectiveBtn, storedDetective ? storedDetective : "YES");
        setRoleState(mayorBtn, storedMayor ? storedMayor : "NO");

        // Ensure values exist in localStorage
        localStorage.setItem("mafias", mafiasInput.value);
        localStorage.setItem("doctor", doctorBtn.innerText);
        localStorage.setItem("detective", detectiveBtn.innerText);
        localStorage.setItem("mayor", mayorBtn.innerText);
      };

      mafiasInput.addEventListener("input", () => {
        const value = mafiasInput.value || 1;
        localStorage.setItem("mafias", value);
      });

      function toggleRole(button) {
        const isYes = button.innerText === "YES";
        const newValue = isYes ? "NO" : "YES";

        setRoleState(button, newValue);

        if (button.id === "doctorBtn") {
          localStorage.setItem("doctor", newValue);
        } else if (button.id === "detectiveBtn") {
          localStorage.setItem("detective", newValue);
        } else {
          localStorage.setItem("mayor", newValue);
        }
      }

      function setRoleState(button, value) {
        button.innerText = value;

        if (value === "YES") {
          button.classList.remove("bg-red-500", "text-white");
          button.classList.add("bg-white", "text-[#050505]");
        } else {
          button.classList.remove("bg-white", "text-[#050505]");
          button.classList.add("bg-red-500", "text-white");
        }
      }

      function startAssignment() {
        window.location.href = "players.html";
      }

      function addRandomBloodPatches(count = 3) {
        const container = document.body;

        for (let i = 0; i < count; i++) {
          const splatter = document.createElement("div");
          const size = Math.random() * 35 + 65; // 65px â€“ 100px
          const rotate = Math.random() * 360;
          const opacity = Math.random() * 0.5 + 0.3;

          const zone = Math.floor(Math.random() * 4);

          let topPx, leftPx;

          const vw = window.innerWidth;
          const vh = window.innerHeight;

          // Safe padding from edge
          const edgeBand = 120;

          switch (zone) {
            case 0: // Top
              topPx = Math.random() * edgeBand;
              leftPx = Math.random() * (vw - size);
              break;

            case 1: // Bottom
              topPx = vh - size - Math.random() * edgeBand;
              leftPx = Math.random() * (vw - size);
              break;

            case 2: // Left
              topPx = Math.random() * (vh - size);
              leftPx = Math.random() * edgeBand;
              break;

            case 3: // Right
              topPx = Math.random() * (vh - size);
              leftPx = vw - size - Math.random() * edgeBand;
              break;
          }

          splatter.className = `
          absolute
          pointer-events-none
          text-red-700
          z-0
          `;

          splatter.style.top = `${topPx}px`;
          splatter.style.left = `${leftPx}px`;
          splatter.style.transform = `rotate(${rotate}deg)`;
          splatter.style.width = `${size}px`;
          splatter.style.height = `${size}px`;
          splatter.style.opacity = opacity;

          splatter.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              class="w-full h-full fill-current">
            <path d="M18.14 16.7c-.91 1.51-2.06 1.03-3.14.39s-2.1-1.41-2.75-.5c-.71.78-.16 2.03.12 3.13c.28 1.11.3 2.07-1.47 2.28c-1.4-.19-1.32-1.35-1.09-2.58s.59-2.53-.31-2.99c-.72-.48-1.22.35-1.85 1.17c-.65.81-1.39 1.6-2.61 1.02c-1.1-.91-.68-1.44-.1-2.12s1.33-1.59.9-3.19c-.18-.65-1.08-.5-1.97-.52c-.87-.02-1.75-.2-1.84-1.5c-.07-.79.52-1.11 1.13-1.36c.62-.25 1.25-.43 1.26-1.06c.03-.61-.38-1.04-.64-1.49s-.37-.92.25-1.62c1.05-.86 1.89-.13 2.73.66s1.67 1.62 2.7.97c.82-.54.07-1.49-.51-2.42s-.99-1.82.51-2.23c1.3-.36 1.8.53 2.25 1.56c.46 1.03.86 2.2 1.96 2.41c1.57.29 2.71-1.55 3.8-3.01s2.16-2.55 3.53-.75c1.5 1.89.07 2.77-1.6 3.55c-1.67.73-3.59 1.37-3.13 2.78c.27.82 1.15.37 2.08.06c.92-.31 1.91-.48 2.39.93c.51 1.49-.7 1.83-2.06 1.97s-2.88.08-2.98.76c-.11.71.8 1 1.59 1.42c.79.43 1.46 1 .85 2.28M20.5 19c-.95 0-1.44-.74-1.44-1.5s.48-1.5 1.44-1.5c1 0 1.5.74 1.5 1.5s-.5 1.5-1.5 1.5"/>
          </svg>`;

          container.appendChild(splatter);
        }
      }

      window.addEventListener("load", () => {
        addRandomBloodPatches(3);
      });
    </script>
  </body>
</html>
